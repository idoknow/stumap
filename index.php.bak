<!--<script>-->
<!--	var file_name,append_str-->
<!--</script>-->
<?  
	function getIp()
	{
    	if ($_SERVER["HTTP_CLIENT_IP"] && strcasecmp($_SERVER["HTTP_CLIENT_IP"], "unknown")) {
        	$ip = $_SERVER["HTTP_CLIENT_IP"];
    	} else {
        	if ($_SERVER["HTTP_X_FORWARDED_FOR"] && strcasecmp($_SERVER["HTTP_X_FORWARDED_FOR"], "unknown")) {
            $ip = $_SERVER["HTTP_X_FORWARDED_FOR"];
        	} else {
            	if ($_SERVER["REMOTE_ADDR"] && strcasecmp($_SERVER["REMOTE_ADDR"], "unknown")) {
                $ip = $_SERVER["REMOTE_ADDR"];
            	} else {
                	if (isset ($_SERVER['REMOTE_ADDR']) && $_SERVER['REMOTE_ADDR'] && strcasecmp($_SERVER['REMOTE_ADDR'],
                        "unknown")
                		) {
                    	$ip = $_SERVER['REMOTE_ADDR'];
                	} else {
                    	$ip = "unknown";
                	}
            	}
        	}
    	}
    	return ($ip);
	}
	function appendFile($filen,$str){
		$file_content=file_get_contents($filen);
		$file_content.=$str;
		$fp0=fopen($filen,"w");
		fwrite($fp0,$file_content);
		fclose($fp0);
	}
	// function appendFileForJS(){
	// 	$filename="<script>document.write(file_name)</script>";
	// 	$str="<script>document.write(append_str)</script>";
	// 	appendFile($filename,$str);
	// }
	
	
    $content = file_get_contents("counter.dat");  //åˆ›å»ºä¸€ä¸ªdatæ•°æ®æ–‡ä»¶
    $content.=getIp()." ".date('Y-m-d H:i:s',time())."\n";
    $fp = fopen("counter.dat","w");  //ä»¥å†™å…¥çš„æ–¹å¼ï¼Œæ‰“å¼€æ–‡ä»¶ï¼Œå¹¶èµ‹å€¼ç»™å˜é‡fp
    fwrite($fp, $content);   //å°†å˜é‡fpçš„å€¼+1
    fclose($fp);
?>
<html lang="zh_CN">
	<?php	
		$page_title="åˆ†å¸ƒå›¾Ofæ¡‚ä¸­21å±Šå­¦ç”Ÿ";//ç½‘é¡µæ ‡é¢˜è®¾ç½®ä¸ºå˜é‡
	?>
    <head>
        <title><?php echo $page_title;?></title>
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
        
        <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=fa71ac657823aa12fef9eb39aa94982d">
        </script>
        <style>
            #myPageTop {
            	width:250px;
            	height: 138px;
				position: fixed;
				bottom: 155px;
				right: 30px;
				background: #fff none repeat scroll 0 0;
				border: 1px solid #ccc;
				margin: 10px auto;
				padding:10px;
				font-family: "Microsoft Yahei", "å¾®è½¯é›…é»‘", "Pinghei";
				font-size: 14px;
				border-radius: 10px;
            	z-index: 100;
			}
			#myPageTop label {
				margin: 0 20px 0 0;
				color: #10AFFF;
				font-weight: normal;
	
			}
			#myPageTop .column2{
				padding-left: 25px;
			}
			#search_stu_tips{
            	color: #10AFFF;
            	position: absolute;
            	top:40px;
            	left: 12px;
			}
			#search_stu{
				width: 70px;
				height: 20px;
				position: absolute;
				left: 80px;
				top: 40px;
			}
			#search_stu_btn{
				width: 80px;
				height: 20px;
				position: absolute;
				left: 160px;
				top: 40px;
			}
			#search_uni_tips{
            	color: #10AFFF;
            	position: absolute;
            	top:70px;
            	left: 12px;
			}
			#search_uni_input{
				width: 70px;
				height: 20px;
				position: absolute;
				left: 80px;
				top: 70px;
			}
			#search_uni_btn{
				width: 80px;
				height: 20px;
				position: absolute;
				left: 160px;
				top: 70px;
			}
			#switch_mode{
				position: absolute;
				bottom: 35px;
				left: 10px;
			}
			#result{
				position: absolute;
				top:12px;
				left: 100;
			}
			
            #container {
            	width:100%;
            	height: 100%;
            	z-index: 1;
            }
            #floating{
            	width:300px;
            	height: 110px;
            	background-color: #FFFFFF;
            	position:fixed;
            	right:30px;
            	bottom:40px;
            	z-index: 100;
            	float: left;
            	border: 1px solid #FFFFFF;
				border-radius: 10px;
            	-webkit-box-shadow:0px 3px 3px #c8c8c8 ;

				-moz-box-shadow:0px 3px 3px #c8c8c8 ;

				box-shadow:0px 3px 3px #c8c8c8 ;
            }
            #checkInfo{
            	color: #10AFFF;
            	float: center;
            	position: absolute;
            	left: 8px;
            	top: 20px;
            }
            #title1{
            	font-weight: bold;
            	font-size: 16px;
            	color: #10AFFF;
            	float: center;
            	position: absolute;
            	left: 8px;
            	top: -7px;
            }
            #class_id_input{
            	position: absolute;
            	bottom: 11px;
            	left: 80px;
            }
            #select_class_tips{
            	color: #10AFFF;
            	position: absolute;
            	bottom: 11px;
            	left: 12px;
            }
            #num_of_class{
            	color: #10AFFF;
            	position: absolute;
            	bottom: 11px;
            	left: 145px;
            }
            .info{
            	font-weight:bold;
            	font-size: small;
            }
            .info span{
            	font-weight:bold;
	color:#ff9955;
            }
            .emoji{
            	font-size: x-large;
            }
            .province_name{
            	color: #10AFFF;
            }
            .uni_name{
            	color: #10DF8F;
            }
            button{
            	width: 200px;
        		background-color: #428bca;  
        		border-color: #357ebd;  
        		color: #fff;  
        		-moz-border-radius: 10px;  
        		-webkit-border-radius: 10px;  
        		border-radius: 4px; /* future proofing */  
        		-khtml-border-radius: 10px; /* for old Konqueror browsers */  
        		text-align: center;  
        		vertical-align: middle;  
        		border: 1px solid transparent;  
        		font-weight: 50;
    			font-size:small 
    			
            }

			#switch_mode{
				padding: 3px
			}
        </style>
    </head>
    <body >
    	<div style="display:none">
    		<script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1280163383'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1280163383%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script>
    		</div>
    	
        <div id="container"></div>
        <div id="myPageTop">
    		<table>
        		<tr>
            		<td>
                		<label id="filter"><h4>ç­›é€‰å™¨ğŸ”</h4></label>
        			</td>
        			<td>
        				<label id="result"></label>
        			</td>
        		</tr>
        		<tr>
        			<td>
        				<label id="search_stu_tips">æŸ¥æ‰¾å§“å</label>
        			</td>
            		<td>
                		<input id="search_stu"/>
            		</td>
            		<td>
            			<button id="search_stu_btn" onclick="class_id=0;document.getElementById('class_id_input').options[0].selected=true;display();onSearchStuBtnClick()">æœç´¢ä¸‹ä¸€ä¸ª</button>
            		</td>
        		</tr>
        		<tr>
        			<td>
        				<label id="search_uni_tips">æŸ¥æ‰¾é™¢æ ¡</label>
        			</td>
        			<td>
        				<input id="search_uni_input"/>
        			</td>
        			<td>
        				<button id="search_uni_btn" onclick="class_id=0;document.getElementById('class_id_input').options[0].selected=true;display();onSearchUniBtnClick()">æœç´¢ä¸‹ä¸€ä¸ª</button>
        			</td>
        		</tr>
        		<tr>
    				<button id="switch_mode" onclick="displayNum()">æ˜¾ç¤ºå„çœäººæ•°ğŸ˜Š</button>
        		</tr>
        		<tr>
        			<td>
        				<label id="select_class_tips">æŸ¥æ‰¾ç­çº§</label>
        			</td>
        			<td>
        				<select id="class_id_input" onchange="class_id=parseInt(document.getElementById('class_id_input').options[document.getElementById('class_id_input').selectedIndex].value);display();">
        				<option value="0">æ‰€æœ‰äºº </option>
        				<option value="384">384ç­</option>
        				<option value="385">385ç­</option>
        				<option value="386">386ç­</option>
        				<option value="387">387ç­</option>
        				<option value="388">388ç­</option>
        				<option value="389">389ç­</option>
        				<option value="390">390ç­</option>
        				<option value="391">391ç­</option>
        				<option value="392">392ç­</option>
        				<option value="393">393ç­</option>
        				<option value="394">394ç­</option>
        				<option value="395">395ç­</option>
        				</select>
        			</td>
        			<td>
        				<label id="num_of_class">å…±äºº</label>
        			</td>
        		</tr>
    		</table>
		</div>
        <div id="floating">
        	<p id="title1">æ¡‚æ—ä¸­å­¦2021å±Šå­¦ç”Ÿåˆ†å¸ƒå›¾ğŸ“¢</p>
        	
        	<p id="checkInfo">
        		ç‚¹EmojiæŸ¥çœ‹ é—®é¢˜æ‰¾<a href="https://qm.qq.com/cgi-bin/qm/qr?k=ZO0dHlDXgp2jBztY9xsdkUoZtQ8YcNw8&noverify=0
                " target="_blank">LWL</a>æˆ–<a href="https://qm.qq.com/cgi-bin/qm/qr?k=yJMzX8TV7LISQ65KKfpNmlLHEtRtWl_k&noverify=0" target="_blank">QJY</a>åé¦ˆğŸ˜›<br/>
        		æ­¤é¡µé¢ä¸<a href="https://glzx.net/plus/view.php?aid=9321" target="_blank">æ¡‚æ—ä¸­å­¦é«˜è€ƒé‡‘æ¦œ</a>åŒæ­¥æ›´æ–°
        		<br/>
        		HurraaaaayğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€
        	</p>
        	
        </div>
        <?php
        	
            $con = mysqli_connect("idoknow.top","smro","qwertyui");
            if (!$con)
            {
                echo 'æ— æ³•è¿æ¥åˆ°æ•°æ®åº“.<br />';
            }
			
            // some code
            mysqli_select_db($con,"stumap");
            $result=mysqli_query($con,"SELECT s.id id,s.class,s.name name,s.scname,u.area,u.lon,u.lat FROM students s
            INNER JOIN nsc u
            ON s.scname=u.scname
            ORDER BY s.id");
            $json="{\"students\":[";
            while($row=mysqli_fetch_array($result,MYSQLI_BOTH))
            {
            	//echo $row['id'] . "\t" . $row['name'] . "\t" . $row['scname'] . "\t" . $row['area'];
            	$json.="{\"id\":\"".$row['id']."\",\"sc\":\"".$row['scname']."\",\"cl\":\"".$row['class']."\",\"na\":\"".$row['name']."\",\"lo\":\"".$row['lon']. "\",\"la\":\"".$row['lat']. "\",\"area\":\"".$row['area']."\"},";
            }
            $json.="{\"id\":\"-1\",\"sc\":\"\",\"cl\":\"-1\",\"na\":\"\",\"lo\":\"0.0\",\"la\":\"0.0\"}]}";
            echo "<script>var json=\"".str_replace("\"","\\\"",$json)."\"</script>";
        ?>
        <script>
        	//test
        
        	//test
        
            var isModeSwitch = 0
            var dd=JSON.parse(json)
            var layer2 = 0
            var marker2
            var markerList=[];
			var mode="detail"
			var isSifted = 0
            
        	var map=new AMap.Map('container',{
        		zoom:4,
        		center:[112,37]
        	})
        	
        	
        	var infoWindow,isOpen=false,lsClickedIndex=-1;
        	function stuList(index){
        		if(!isOpen||lsClickedIndex!=index){
        			var content
        			content="<div><h4 class=\"uni_name\">"+dd.students[index].sc+"</h4><p class=\"info\">"
        			for(i=0;i<dd.students.length;i++){
        				if(class_id==0||(class_id!=0&&dd.students[i].cl==class_id)){
        					if(dd.students[i].sc==dd.students[index].sc){
        						content+=dd.students[i].cl+"ç­ "+dd.students[i].na+"<br/>"
        					}
        				}
        			}
        			content+="</p></div>"
        			infoWindow=new AMap.InfoWindow({
        				content:content,
        				offset:new AMap.Pixel(11,-15)
        			})
        			infoWindow.open(map,new AMap.LngLat(parseFloat(dd.students[index].lo),parseFloat(dd.students[index].la)))
        			isOpen=true
        			lsClickedIndex=index;
        		}else if(index==lsClickedIndex){
        			infoWindow.close()
        			isOpen=false
        		}
        	}
        	
        	
        	var class_id=0;
			
        	
        	function display(){
				console.log("display()->mode:"+mode)
				if(mode == "province" && layer2 != 0){//å¦‚æœæ­¤æ—¶åœ¨æ˜¾ç¤ºçœä»½ä¿¡æ¯
					isSifted =1
					map.remove(layer2)
					// console.log("calling display for mode == \"province\" && layer2 != 0")
					displayNum()
					
				}
				if(class_id == 0){
					isSifted = 0
				}
				
        		for(i=0;i<markerList.length;i++){
        			map.remove(markerList[i])
        		}
        		markerList=[]
				var siftedStuCount = 0
        		for(i=0;i<dd.students.length-1;i++){
        			if(class_id==0||(class_id!=0&&dd.students[i].cl==class_id)){
						siftedStuCount += 1
						if(mode == "detail"){
							//å¦‚æœmodeæ˜¯detailå†æ˜¾ç¤ºemoji
						    var emo;
        				    if(dd.students[i].na=='ç§¦éªè¨€'||dd.students[i].na=='ç§¦éªè¨€.'){
        				    	emo='ğŸ°'
        			    	}else if(dd.students[i].sc=='æ¡‚æ—ä¸­å­¦'){
        			    		emo='ğŸ«'
        			    	}else if(dd.students[i].sc=='å—äº¬å®¡è®¡å¤§å­¦'){
        			    		emo='ğŸ»';
        			    	}else{
        			    		emo=randEmoji()
        			    	}
        			    	marker2=new AMap.Marker({
        			    		content:'<p class="emoji" onclick=stuList('+i+')>'+emo+'</p>',
        			    		position:new AMap.LngLat(parseFloat(dd.students[i].lo),parseFloat(dd.students[i].la)),
        			    		offset: new AMap.Pixel(-1,-30)
        			    	})
        			    	markerList[markerList.length]=marker2
							
					    	map.add(marker2)
						}
        			}
        		}
        		document.getElementById("num_of_class").innerHTML=('å…±'+siftedStuCount+'äºº')
        	}
        	var emojis=['ğŸ˜„','ğŸ–','ğŸ˜','ğŸ˜‚','ğŸ˜‰','ğŸ˜Š','ğŸ˜','ğŸ¥°','ğŸ˜œ','ğŸ˜†','ğŸ¤™','ğŸ¤£','ğŸ§']
        	function randEmoji(){
        		var r=Math.round(Math.random()*10)%emojis.length
        		var e=emojis[r]
        		return e
        	}
        	console.log("Â©2021 idoknow.top")
        	display()
        	
        	var lsNameIndex=0,lsNameSearch=""
        	function onSearchStuBtnClick(){
        		var searchText = document.getElementById("search_stu").value
        		_czc.push(["_trackEvent","æœç´¢","æœç´¢å§“å",searchText,searchText])
        		if(searchText==""){
        			return
        		}
        		
        		
        		// file_name="search.record"
        		// append_str=searchText+"\n"
        		// TODO call PHP's function to record searching
        		if(searchText!=lsNameSearch){
        			lsNameIndex=0
        		}
        		var i=0;
        		for(i=lsNameIndex+1;i<dd.students.length-1;i++){
        			if(dd.students[i].na.indexOf(searchText)!=-1){
        				// if((dd.students[i].cl!=class_id)&&(class_id!=0)){
        				// 	console.log(dd.students[i].cl+" "+class_id)
        				// 	class_id=0
        				// 	display()
        				// }
        				map.panTo([dd.students[i].lo,dd.students[i].la])
        				map.setZoom(15)
        				stuList(i)
        				lsNameIndex=i
        				lsNameSearch=searchText
        				// document.getElementById("myPageTop").setAttribute('style', 'z-index:100;');
        				return
        			}
        		}
        		alert("æ‰¾ä¸åˆ°ğŸ˜­")
        		// document.getElementById("myPageTop").setAttribute('style', 'z-index:100;');
        	}
        	var lsUniIndex=0,lsUniSearch="",lsSearchResult="";
        	function onSearchUniBtnClick(){
        		var searchText = document.getElementById("search_uni_input").value
        		_czc.push(["_trackEvent","æœç´¢","æœç´¢å§“å",searchText,searchText])
        		if(searchText==""){
        			return
        		}
        		if(lsUniSearch!=searchText){
        			lsUniIndex=0
        			lsSearchResult=""
        		}
        		var i=0
        		for(i=lsUniIndex+1;i<dd.students.length-1;i++){
        			if(dd.students[i].sc.indexOf(searchText)!=-1&&dd.students[i].sc!=lsSearchResult){
        				// if((dd.students[i].cl!=class_id)&&(class_id!=0)){
        				// 	console.log(dd.students[i].cl+" "+class_id)
        				// 	class_id=0
        				// 	display()
        				// }
        				map.panTo([dd.students[i].lo,dd.students[i].la])
        				map.setZoom(15)
        				stuList(i)
        				lsUniIndex=i
        				lsUniSearch=searchText
        				lsSearchResult=dd.students[i].sc
        				return
        			}
        		}
        		alert("æ‰¾ä¸åˆ°ğŸ˜­")
        	}
        	
        	
        	var province_info_window,stu_index_of_ls_select_province=-1;
        	function displayNum(){
				console.log("displayNum()->mode:"+mode)
        		var LabelsData = [];
				
	
        		var districts = [
    					{
        					citycode: [],
    						adcode: "440000",
        					name: "å¹¿ä¸œçœ",
        					center: "113.280637,23.125178",
        					level: "province",
        					districts: []
    					},
    					{
        					citycode: [],
        					adcode: "410000",
        					name: "æ²³å—çœ",
        					center: "113.665412,34.757975",
        					level: "province",
        					districts: []
    					},
        				{
            				citycode: [],
                			adcode: "150000",
                			name: "å†…è’™å¤è‡ªæ²»åŒº",
                			center: "111.670801,40.818311",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "230000",
                			name: "é»‘é¾™æ±Ÿçœ",
                			center: "126.642464,45.756967",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "650000",
                			name: "æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº",
               				center: "87.617733,43.792818",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "420000",
                			name: "æ¹–åŒ—çœ",
                			center: "114.298572,30.584355",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "210000",
                			name: "è¾½å®çœ",
                			center: "123.429096,41.796767",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "370000",
                			name: "å±±ä¸œçœ",
                			center: "117.000923,36.675807",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "610000",
                			name: "é™•è¥¿çœ",
                			center: "108.948024,34.263161",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: "021",
                			adcode: "310000",
                			name: "ä¸Šæµ·å¸‚",
                			center: "121.472644,31.231706",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "520000",
                			name: "è´µå·çœ",
                			center: "106.713478,26.578343",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: "023",
                			adcode: "500000",
                			name: "é‡åº†å¸‚",
                			center: "106.504962,29.533155",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "540000",
                			name: "è¥¿è—è‡ªæ²»åŒº",
                			center: "91.132212,29.660361",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "340000",
                			name: "å®‰å¾½çœ",
                			center: "117.283042,31.86119",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "350000",
                			name: "ç¦å»ºçœ",
                			center: "119.306239,26.075302",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "430000",
                			name: "æ¹–å—çœ",
                			center: "112.982279,28.19409",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "460000",
                			name: "æµ·å—çœ",
                			center: "110.33119,20.031971",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "320000",
                			name: "æ±Ÿè‹çœ",
                			center: "118.767413,32.041544",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "630000",
                			name: "é’æµ·çœ",
                			center: "101.778916,36.623178",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "450000",
                			name: "å¹¿è¥¿å£®æ—è‡ªæ²»åŒº",
                			center: "108.320004,22.82402",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "640000",
                			name: "å®å¤å›æ—è‡ªæ²»åŒº",
                			center: "106.278179,38.46637",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "360000",
                			name: "æ±Ÿè¥¿çœ",
                			center: "115.892151,28.676493",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "330000",
                			name: "æµ™æ±Ÿçœ",
                			center: "120.153576,30.287459",
                			level: "province",
               				districts: []
    					},
            			{
                			citycode: [],
                			adcode: "130000",
                			name: "æ²³åŒ—çœ",
                			center: "114.502461,38.045474",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: "1853",
                			adcode: "820000",
                			name: "æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº",
                			center: "113.54909,22.198951",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: "1886",
                			adcode: "710000",
                			name: "å°æ¹¾çœ",
                			center: "121.509062,25.044332",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: "1852",
                			adcode: "810000",
                			name: "é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº",
                			center: "114.173355,22.320048",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "620000",
                			name: "ç”˜è‚ƒçœ",
                			center: "103.823557,36.058039",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "510000",
                			name: "å››å·çœ",
                			center: "104.065735,30.659462",
                			level: "province",
                			districts: []
            			},
            			{
                			citycode: [],
                			adcode: "220000",
                			name: "å‰æ—çœ",
                			center: "125.3245,43.886841",
                			level: "province",
               				districts: []
            			},
            			{
                			citycode: "022",
                			adcode: "120000",
                			name: "å¤©æ´¥å¸‚",
                			center: "117.190182,39.125596",
                			level: "province",
                			districts: []
        			    },
        			    {
        			        citycode: [],
        			        adcode: "530000",
        			        name: "äº‘å—çœ",
        			        center: "102.712251,25.040609",
        			        level: "province",
        			        districts: []
        			    },
        			    {
        			        citycode: "010",
        			        adcode: "110000",
        			        name: "åŒ—äº¬å¸‚",
        			        center: "116.405285,39.904989",
        			        level: "province",
        			        districts: []
        			    },
        			    {
        			        citycode: [],
        			        adcode: "140000",
        			        name: "å±±è¥¿çœ",
        			        center: "112.549248,37.857014",
        			        level: "province",
        			        districts: []
        			    }
        			];	
        		if(mode=="detail" || (mode=="province"&&isSifted==1)){//here!! class_id is already set to 0,skip this statement
        			if(province_info_window!=null){
        				province_info_window.close()
        				stu_index_of_ls_select_province=-1;
        			}
        			if(infoWindow!=null)
        				infoWindow.close()
					isSifted = 0
        			const directions = {
        			    'åŒ—äº¬å¸‚':'top',
        			    'æ²³åŒ—çœ':'right',
        			    'å®å¤å›æ—è‡ªæ²»åŒº':'bottom',
        			    'æµ™æ±Ÿçœ':'bottom',
        			    'ä¸Šæµ·å¸‚':'right',
        			    'é’æµ·çœ': 'left',
        			    'é»‘é¾™æ±Ÿçœ':'top',
        			    'æ±Ÿè‹çœ':'right',
        			    'å®‰å¾½çœ':'top',
        			    'é‡åº†å¸‚':'right',
        			    'æ¹–å—çœ':'left',
        			    'æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº':'bottom',
        			    'é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº':'right',
        			    'å°æ¹¾çœ':'bottom',
        			    'å†…è’™å¤è‡ªæ²»åŒº':'top',
        			
        			};
        			// console.log(districts)
        			// var dd=JSON.parse(json)
        			// console.log("stuinfo111111111111"+dd.students[0])
        			var ii = 0
        			var districtTemp
        			var stuAreaCache={"init":-1}
        			var areaStusCache={"init":-1}
        			for(var j=0;j<dd.students.length-1;j++){
        				if(class_id == 0){
        					if(!!stuAreaCache[dd.students[j].area]){
        					//å¦‚æœå­˜åœ¨
        					stuAreaCache[dd.students[j].area] = stuAreaCache[dd.students[j].area] + 1
        				}else{
        					stuAreaCache[dd.students[j].area] = 1
        				}
        				}else{
        					if(class_id == dd.students[j].cl){
        						if(!!stuAreaCache[dd.students[j].area]){
        					//å¦‚æœå­˜åœ¨
        					stuAreaCache[dd.students[j].area] = stuAreaCache[dd.students[j].area] + 1
        					areaStusCache[dd.students[j].area] = areaStusCache[dd.students[j].area] + "\n" +  dd.students[j].na
        				}else{
        					stuAreaCache[dd.students[j].area] = 1
        					areaStusCache[dd.students[j].area] = dd.students[j].na
        				}
        				
        					}
        					
        				}
        			
        				
        			}
        			console.log(stuAreaCache)
        			console.log(areaStusCache)
        			for (var loop=0;loop<34;loop++){
        				districtTemp = districts[loop]
        				if(!!stuAreaCache[districtTemp.name]){
        					if(class_id!=0){
        						districts[loop].name = districts[loop].name+ " "+stuAreaCache[districtTemp.name]+"äºº:" + "\n" + areaStusCache[districtTemp.name]
        					}else{
        						districts[loop].name = districts[loop].name+ " "+stuAreaCache[districtTemp.name]+"äºº"
        					}
        					
        				}else{
        					districts[loop].name = ""
        				}
        			}
        			console.log(districts)
       // 			for (var loop = 0;loop < 34;loop++){
       // 				districtTemp = districts[loop]
       // 			    // console.log(districtTemp.name)
       // 			   	var stu_count = 0
       // 			   	for(var j = 0;j<dd.students.length;j++){
       // 			   		console.log("dd.students.length="+dd.students.length)
       // 			   		// console.log("stuinfo"+dd.students[j].area)
							// if(class_id == 0){
							// 	if(districtTemp.name == dd.students[j].area){
       // 		    				stu_count+=1
       // 		    		     	console.log("class_id=0")
       // 		    		    }
							// }else{
							// 	console.log("class_id="+class_id)
							// 	if(districtTemp.name == dd.students[j].area && class_id == dd.students[j].cl){
							// 		stu_count+=1
							// 	}
							// }
        			   		
       //			    	}
       //			    	if(stu_count != 0){
       //			    		// if(districts[ii].name.indexOf("çœ")!=-1){
       //			    		// 	districts[ii].name.replace("çœ","")
       //			    		// }else if(districts[ii].name.indexOf("che")!=-1)
       			    		
       //			    		districts[ii].name = districts[ii].name+ " "+stu_count+"äºº"
       //			    	}else{
       //			    		districts[ii].name = ""
       //			    	}
       //			    	// console.log("res:"+districts[ii].name)
       //			    	ii+=1
       // 			}
        			var textStyle = {
                            fontSize: 16,
                            fontWeight: 'normal',
                            fillColor: '#fff',
                            padding: '2, 5',
                            backgroundColor: '#10AFFF',
                            borderColor: '#fff',
                            borderWidth: 1,
        				};
        			var textStyleForScreen = {
                            fontSize: 13,
                            fontWeight: 'normal',
                            fillColor: '#fff',
                            padding: '2, 5',
                            backgroundColor: '#10AFFF',
                            borderColor: '#fff',
                            borderWidth: 1,
        				};
        			
        			
        			for (var i1 = 0; i1 < districts.length; i1++) {
        				
        				
        				if(class_id!=0){
        				var config = {
        			    	
        			        name: '',
        			        position: [116.12, 39.11],
        			        zooms: [4, 13],
        			        zIndex: 1,
        			        opacity: 1,
        			        text: {
        			            content: '',
        			            direction: 'center',
        			            offset: [0, 0],
        			            zooms: [3, 20],
        			            style: textStyleForScreen,
        			        }
        			    };
        			}else{
        				var config = {
        			    	
        			        name: '',
        			        position: [116.12, 39.11],
        			        zooms: [4, 13],
        			        zIndex: 1,
        			        opacity: 1,
        			        text: {
        			            content: '',
        			            direction: 'center',
        			            offset: [0, 0],
        			            zooms: [3, 20],
        			            style: textStyle,
        			        }
        			    };
        			}	
        			    
        			    var district = districts[i1];
        			    // console.log(district)
        			    var name = district.name;
        			    config.text.content = name;
        			    config.position = district.center.split(',');
        			    if (directions[name]) {
        			        config.text.direction = directions[name];
        			    }
        			    LabelsData.push(config);
        			}

        		    layer2 = new AMap.LabelsLayer({
        		        // å¼€å¯æ ‡æ³¨é¿è®©ï¼Œé»˜è®¤ä¸ºå¼€å¯ï¼Œv1.4.15 æ–°å¢å±æ€§
        		        collision: false,
        		        // å¼€å¯æ ‡æ³¨æ·¡å…¥åŠ¨ç”»ï¼Œé»˜è®¤ä¸ºå¼€å¯ï¼Œv1.4.15 æ–°å¢å±æ€§
        		        animation: true,
        		    });
        		    var normalMarker = new AMap.Marker({
                		anchor: 'bottom-center',
                		offset: [0, -15],
                	});
        		    for (var i = 0; i < LabelsData.length; i++) {
        		        var labelsMarker = new AMap.LabelMarker(LabelsData[i]);
        		        // console.log(LabelsData[i])
        		         // ç»™markerç»‘å®šäº‹ä»¶
            			labelsMarker.on('click', function(e){
            	
            				// console.log(e.data.data.position)
            				var specific_stu_index
            				for(var i = 0;i<dd.students.length;i++){
            					
            					if(e.data.data.txt.split(" ")[0] == dd.students[i].area){
            						specific_stu_index=i
            						break
            					}
            				}
            				if(stu_index_of_ls_select_province!=-1&&specific_stu_index==stu_index_of_ls_select_province){//æ£€æµ‹å‘ç°ç‚¹å‡»çš„æ ‡ç­¾å’Œä¸Šæ¬¡ç‚¹å‡»çš„æ˜¯åŒä¸€ä¸ªï¼Œåˆ™å…³é—­infoWindow
            					province_info_window.close()
            					stu_index_of_ls_select_province=-1
            					return
            				}
            				stu_index_of_ls_select_province=specific_stu_index
                			var content
        					content="<div><h4 class=\"province_name\">"+dd.students[specific_stu_index].area+"</h4><p class=\"info\">"
        					for(i=specific_stu_index;i<dd.students.length-1;i++){
        						if(class_id==0||(class_id!=0&&dd.students[i].cl==class_id)){
        							if(dd.students[i].area==dd.students[specific_stu_index].area){
        								content+=dd.students[i].cl+"ç­ "+dd.students[i].na+ "  <span>"+dd.students[i].sc+"</span> <br/>"
        							}
        						}
        					}
        					content+="</p></div>"
                			if(province_info_window!=null){
                				province_info_window.close()
                			}
                			province_info_window=new AMap.InfoWindow({
        						content:content,
        						offset:new AMap.Pixel(11,-15)
        					})
        					// province_info_window.open(map,new AMap.LngLat(parseFloat(dd.students[specific_stu_index].lo),parseFloat(dd.students[specific_stu_index].la)))
                			province_info_window.open(map,new AMap.LngLat(e.data.data.position[0],e.data.data.position[1]))
                        });//äº‹ä»¶ç»“æŸ
        		        layer2.add(labelsMarker);
        		    }
        		
        		    map.setZoom(5)
        		    map.setCenter([113.12, 35.11])
        		    map.add(layer2)
        		    for(i=0;i<markerList.length;i++){
        		         map.remove(markerList[i])
        		    }
        		    
        		    isModeSwitch = 1
        		    document.getElementById("switch_mode").innerHTML = 'æ˜¾ç¤ºå…·ä½“æƒ…å†µğŸ¤£'
        		    mode="province"
					console.log(mode)
        		    if(infoWindow!=null)
        		    	infoWindow.close()
    			}else{
        		        			//å¦‚æœæ²¡æœ‰åˆ‡æ¢æ¨¡å¼
        			if(province_info_window!=null){
        				province_info_window.close()
        				stu_index_of_ls_select_province=-1
        			}
        			if(infoWindow!=null)
        				infoWindow.close()
    				map.setZoom(4)
        			document.getElementById("switch_mode").innerHTML = 'æ˜¾ç¤ºå„çœäººæ•°ğŸ˜Š'
        		    map.remove(layer2)
        		    
        		    for(i=0;i<markerList.length;i++){
        		        map.add(markerList[i])
        		    }
					
        		    layer2 = 0 //å˜å›numberç±»å‹
        		    mode="detail"
					display()
        		    console.log(mode)
        		    if(province_info_window!=null)
        		    	province_info_window.close();
					

        		}
        	}
        		        	

        </script>
    </body>
</html>